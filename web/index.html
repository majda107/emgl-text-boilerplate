<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>

    <!-- Create the canvas that the C++ code will draw into -->
    <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>

    <!-- Allow the C++ to access the canvas element -->
    <script type='text/javascript'>
        var canv = document.getElementById('canvas');
        var Module = {
            canvas: canv
        };
    </script>

    <!-- Call the javascript glue code (index.js) as generated by Emscripten, located in bin folder -->
    <script src="index.js"></script>

    <!-- Bind C++ functions -->
    <script type='text/javascript'>
        canv.addEventListener('click', _toggle_background_color, false);
        canv.addEventListener('touchend', _toggle_background_color, false);

        // canv.addEventListener('mousemove', (e) => {

        //     let rect = canv.getBoundingClientRect()

        //     let x = e.clientX - rect.left
        //     let y = e.clientY - rect.top

        //     drawTriangle(x, y)
        // })

        window.addEventListener('keypress', (e) => {
            if (e.keyCode > 31 && e.keyCode < 127) {
                console.log(`Appending ${e.keyCode}`)
                _append_letter(e.keyCode)
            }
        })

        window.addEventListener('keydown', e => {
            if (e.keyCode == 8) {
                console.log("Removing letter")
                _remove_letter()
            }
        })

        function drawTriangle(x = 0.5, y = 0.2) {
            _draw_triangle(x, y)
        }

        function canvasXY(e) {
            let rect = canv.getBoundingClientRect()

            let x = rect.left - e.clientX 
            let y = e.clientY - rect.top

            return { x: x, y: y }
        }


        canv.addEventListener('mousedown', e => {
            let xy = canvasXY(e)
            _mouse_down(xy.x, xy.y)
        })

        canv.addEventListener('mouseup', e => {
            let xy = canvasXY(e)
            _mouse_up(xy.x, xy.y)
        })

        canv.addEventListener('mousemove', e => {
            let xy = canvasXY(e)
            _mouse_move(xy.x, xy.y)
        })

        let scale = 1.0
        canv.addEventListener('wheel', e => {
            scale += e.deltaY * -0.001
            _mouse_zoom(scale)
        })

    </script>

    <!-- U may completely delete this trash description ... -->
    <div>
        <p>Type on keyboard to change text, drag / zoom to position canvas</p>
        <hr>
        <p>Simple Antialiased OpenGL ES 3.0 Emscripten WebAssembly example</p>
        <p>Source code: <a
                href="https://github.com/majda107/emgl-boilerplate">https://github.com/majda107/emgl-boilerplate</a></p>
        <hr>
        <p>
            Inspired by:
            <ul>
                <li><a
                        href="https://github.com/krogank9/sdl_ogl_tests/blob/master/vg/src/main.cpp">https://github.com/krogank9/sdl_ogl_tests/blob/master/vg/src/main.cpp</a>
                </li>
                <li><a
                        href="https://gist.github.com/derofim/261630cc9eea7fce431710dc2e97b094">https://gist.github.com/derofim/261630cc9eea7fce431710dc2e97b094</a>
                </li>
                <li><a
                        href="https://github.com/timhutton/opengl-canvas-wasm">https://github.com/timhutton/opengl-canvas-wasm</a>
                </li>
            </ul>
        </p>
    </div>

</body>

</html>